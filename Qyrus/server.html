<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPDATE</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


    <style>
        nav {
            width: 153%;
            height: 37px;
            background: rgb(7, 190, 240);
            opacity: 0.8;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 20px 0px 20px;
        }

        nav .logo {
            height: 50px;
            position: relative;
            width: 170px;
            float: left;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin: 0 5px;
        }

        nav ul li a {
            text-decoration: none;
            color: rgb(10, 9, 9);
            font-size: 18px;
            font-weight: 500;
            letter-spacing: 1px;
            padding: 8px 10px;
            border-radius: 2px;
            transition: all 0.5s ease;
        }

        nav ul li a:hover {
            color: black;
            background: #38d39f;
            font-weight: 500;

        }

        .error {
            position: absolute;
            top: -110%;
            left: 31%;
            padding: 1% 20%;
            border-radius: 3px;
            background-color: #FDCAC4;
            color: #ED6160;
            display: none;
        }

        .error::before {
            content: "";
            width: 0;
            height: 0;
            border-left: 9px solid transparent;
            border-right: 9px solid transparent;

            border-top: 9px solid #FDCAC4;
            position: absolute;
            bottom: -21%;
            left: 10%;
        }

        .error:nth-child(2) {
            top: 70px;
            background-color: #D9F0FD;
        }

        .error:nth-child(2)::before {
            border-top: 9px solid #D9F0FD;
        }

        .error:nth-child(3) {
            top: 140px;
            padding: 1% 18%;
            background-color: #6DFFA7;
        }

        .error:nth-child(3)::before {
            border-top: 9px solid #6DFFA7;
        }

        .error:nth-child(4) {
            top: 210px;
            background-color: #ffd866;
        }

        .error:nth-child(4)::before {
            border-top: 9px solid #ffd866;
        }
    </style>
</head>

<body>
    <nav>
        <img class="logo" src="logo.png" alt="logo">
        <ul>
            <li><a href="https://www.qyrus.com/">HOME</a></li>
            <li><a href="navigate.html">BACK</a></li>
            <li><a href="index.html">LOGOUT</a></li>
        </ul>
    </nav>
    <br />
    <div class="search-wrapper">
        <label for="search"></label>
        <input type="search" placeholder="Search" id="search" data-search>
    </div>
    <div class="container mt-5 p-3 ">
        <div class="row">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <h4 class="text-center">Server Configuration</h4>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="">ID</label>
                            <input type="text" name="" class="form-control" placeholder="ID" id="id" required>
                        </div>
                        <div class="form-group">
                            <label for="">Type Of Device</label>
                            <select type="text" name="typeofdevice" class="form-control" placeholder="Type Of Device"
                                id="typeofdevice" required>
                                <option value="Server">Server</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="">Created By</label>
                            <input type="text" name="" class="form-control" placeholder="Created By" id="deviceaddedby"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="">Edited By</label>
                            <input type="text" name="" class="form-control" placeholder="Edited By"
                                id="deviceupdatedby">
                        </div>
                        <div class="form-group">
                            <label for="">Manufacturer</label>
                            <input type="text" name="" class="form-control" placeholder="Manufacturer" id="manufacturer"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="">Make</label>
                            <input type="text" name="" class="form-control" placeholder="Make" id="make" required>
                        </div>

                        <div class="form-group">
                            <label for="">Model</label>
                            <input type="text" name="" class="form-control" placeholder="Model" id="model" required>
                        </div>
                        <div class="form-group">
                            <label for="">OS</label>
                            <select type="text" name="" class="form-control" placeholder="OS" id="os" required>
                                <option value="IOS">IOS</option>
                                <option value="Andriod">Andriod</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="">Date of Purchase</label>
                            <input type="date" name="" class="form-control" placeholder="Date of Purchase"
                                id="dateofpurchase" required>
                        </div>
                        <div class="form-group">
                            <label for="">Current Client</label>
                            <input type="text" name="" class="form-control" placeholder="Current Client"
                                id="currentclient" required>
                        </div>
                        <div class="form-group">
                            <label for="">Device ID</label>
                            <input type="text" name="" class="form-control" placeholder="Device ID" id="deviceid"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="">Serial No</label>
                            <input type="text" name="" class="form-control" placeholder="Serial No" id="serialnumber"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="">Location Of Hosting</label>
                            <select type="text" name="" class="form-control" placeholder="Location Of Hosting"
                                id="locationofhosting" required>
                                <option value="India">India</option>
                                <option value="UK">UK</option>
                                <option value="US">US</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="">Status</label>
                            <select type="text" name="" class="form-control" placeholder="Status" id="status" required>
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                                <option value="Damaged">Damaged</option>
                            </select>
                        </div>
                        <div class="row" style="margin-top:15%;">
                            <div class="col-md-11 offset-0">
                                <div id="validate">
                                    <label for="">IP Address</label>
                                    <label for="Tooltips" class="error"></label>
                                    <input type="text" id="ipaddress" placeholder="0.0.0.0" class="form-control">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="">BYOD</label>
                            <select type="text" name="" class="form-control" placeholder="BYOD" id="byod" required>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="">Reason for Deactivating</label>
                            <input type="text" name="" class="form-control" placeholder="ROD" id="reason">
                        </div>

                        <div class="mt-3">
                            <button class="btn btn-primary float-right" onclick="submitForm()">Submit</button>
                        </div>
                        <!--<div class="w-100">
                            <span id="message" class="alert alert-success"></span>
                        </div>-->
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <table class="table table-bordered text-pink text-center">
                    <thead>
                        <th>Update</th>
                        <th>Id</th>
                        <th>Type of Device</th>
                        <th>Created By</th>
                        <th>Updated By</th>
                        <th>Manufacturer</th>
                        <th>Make</th>
                        <th>Model</th>
                        <th>OS</th>
                        <th>Date of Purchase</th>
                        <th>Current Client</th>
                        <th>Device ID</th>
                        <th>Serial No</th>
                        <th>Location Of Hosting</th>
                        <th>IP Address</th>
                        <th>Status</th>
                        <th>BYOD</th>
                        <th>Reason For Deactivating</th>
                    </thead>
                    <tbody id="tcData">

                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        $(document).ready(function () {

            $("#search").on("keyup", function () {

                var value = $(this).val().toUpperCase();

                $("#tcData tr").filter(function () {

                    $(this).toggle($(this).text().toUpperCase().indexOf(value) > -1)

                });

            });
            $('#ipaddress').on('focusout', function () {

if ($('#ipaddress').val() != "") {

    if (validateIp($('#ipaddress').val())) {

        $('.error').fadeOut('slow');

    } else {
        $('.error').text('Invalid IP!');
        $('.error').fadeIn('slow');
    }

} else {
    $('.error').text('IP Required..!');
    $('.error').fadeIn("slow");
}



});

        });
        var editFormData;

        function getFormData() {
            return {
                id: document.getElementById("id").value,
                typeofdevice: document.getElementById("typeofdevice").value,
                deviceaddedby: document.getElementById("deviceaddedby").value,
                deviceupdatedby: document.getElementById("deviceupdatedby").value,
                manufacturer: document.getElementById("manufacturer").value,
                make: document.getElementById("make").value,
                model: document.getElementById("model").value,
                os: document.getElementById("os").value,
                dateofpurchase: document.getElementById("dateofpurchase").value,
                currentclient: document.getElementById("currentclient").value,
                deviceid: document.getElementById("deviceid").value,
                serialnumber: document.getElementById("serialnumber").value,
                status: document.getElementById("status").value,
                ipaddress: document.getElementById("ipaddress").value,
                byod: document.getElementById("byod").value,
                locationofhosting: document.getElementById("locationofhosting").value,
                reason: document.getElementById("reason").value,

            }
        }
        function clearFormData() {
            document.getElementById("id").value = "";
            document.getElementById("typeofdevice").value = "";
            document.getElementById("deviceaddedby").value = "";
            document.getElementById("deviceupdatedby").value = "";
            document.getElementById("manufacturer").value = "";
            document.getElementById("make").value = "";
            document.getElementById("model").value = "";
            document.getElementById("os").value = "";
            document.getElementById("dateofpurchase").value = "";
            document.getElementById("currentclient").value = "";
            document.getElementById("deviceid").value = "";
            document.getElementById("serialnumber").value = "";
            document.getElementById("status").value = "";
            document.getElementById("ipaddress").value = "";
            document.getElementById("byod").value = "";
            document.getElementById("locationofhosting").value = "";
            document.getElementById("reason").value = "";

        }

        function setFormData(id, typeofdevice, deviceaddedby, deviceupdatedby, manufacturer, make, model, os, dateofpurchase, currentclient, deviceid, serialnumber, status, byod, ipaddress, locationofhosting,reason) {
            document.getElementById("id").value = id;
            document.getElementById("typeofdevice").value = typeofdevice;
            document.getElementById("deviceaddedby").value = deviceaddedby;
            document.getElementById("deviceupdatedby").value = deviceupdatedby;
            document.getElementById("manufacturer").value = manufacturer;
            document.getElementById("make").value = make;
            document.getElementById("model").value = model;
            document.getElementById("os").value = os;
            document.getElementById("dateofpurchase").value = dateofpurchase;
            document.getElementById("currentclient").value = currentclient;
            document.getElementById("deviceid").value = deviceid;
            document.getElementById("serialnumber").value = serialnumber;
            document.getElementById("status").value = status;
            document.getElementById("byod").value = byod;
            document.getElementById("ipaddress").value = ipaddress;
            document.getElementById("locationofhosting").value = locationofhosting;
            document.getElementById("reason").value = reason;

        }

        // set the message for form status
        /*function setSuccessMessage(message) {
            document.getElementById("message").innerHTML = message;
        }*/
        function editDatacall(id) {
            console.log(id);
            // call get user details by id API
            fetch("http://localhost:8080/server/devices?serverid=" + id, {
                method: "GET",
                mode: "cors",
            }).then((res) => res.json()).then((response) => {
                console.log("Edit info", response);
                editFormData = response;
                console.log(editFormData);
                setFormData(editFormData.id, editFormData.typeofdevice, editFormData.deviceaddedby, editFormData.deviceupdatedby, editFormData.manufacturer, editFormData.make, editFormData.model, editFormData.os, editFormData.dateofpurchase, editFormData.currentclient, editFormData.deviceid, editFormData.serialnumber, editFormData.status, editFormData.byod, editFormData.ipaddress, editFormData.locationofhosting, editFormData.phonenumber, editFormData.reason)
            })
        }


        // callled this function when user click on button
        function submitForm() {
            if (!editFormData) addMobile(); // if the editFormData is undefined then call addUser()
            else editData();
        }
        function addMobile() {
            let payload = getFormData();
            fetch("http://localhost:8080/server/add", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(payload)
            }).then((res) => res.json()).then((response) => {
                //setSuccessMessage(response.message)
                // clear input email and name
                clearFormData();
                getData();
            })
        }
        // edit data 
        function editData() {
            var formData = getFormData();
            formData['id'] = editFormData.id; // get _id from selected user
            fetch("http://localhost:8080/server/update", {
                method: "PUT", mode: "cors",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(formData)
            }).then((res) => res.json()).then((response) => {
                //setSuccessMessage(response.message)
                clearFormData(); // clear the form field
                getData() // reload the table
            })
        }
        //view users
        function getData() {
            fetch("http://localhost:8080/server/all").then(
                (res) => res.json()
            ).then((response) => {
                var tmpData = "";
                console.log(response);
                response.forEach((user) => {
                    tmpData += "<tr>"
                    tmpData += "<td><button class='btn btn-primary' onclick='editDatacall(`" + user.id + "`)'>Update</button></td>";
                    tmpData += "<td>" + user.id + "</td>";
                    tmpData += "<td>" + user.typeofdevice + "</td>";
                    tmpData += "<td>" + user.deviceaddedby + "</td>";
                    tmpData += "<td>" + user.deviceupdatedby + "</td>";
                    tmpData += "<td>" + user.manufacturer + "</td>";
                    tmpData += "<td>" + user.make + "</td>";
                    tmpData += "<td>" + user.model + "</td>";
                    tmpData += "<td>" + user.os + "</td>";
                    tmpData += "<td>" + user.dateofpurchase + "</td>";
                    tmpData += "<td>" + user.currentclient + "</td>";
                    tmpData += "<td>" + user.deviceid + "</td>";
                    tmpData += "<td>" + user.serialnumber + "</td>";
                    tmpData += "<td>" + user.locationofhosting + "</td>";
                    tmpData += "<td>" + user.ipaddress + "</td>";
                    tmpData += "<td>" + user.status + "</td>";
                    tmpData += "<td>" + user.byod + "</td>";
                    tmpData += "<td>" + user.reason + "</td>";
                    tmpData += "</tr>";
                })
                document.getElementById("tcData").innerHTML = tmpData;
            })
        }
        getData();

        function validateIp(eVal) {
            var val = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;

            if (val.test(eVal)) {
                return true;
            } else {
                return false;
            }
        }
    </script>
</body>

</html>